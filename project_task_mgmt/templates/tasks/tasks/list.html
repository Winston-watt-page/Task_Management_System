{% extends 'tasks/base.html' %}

{% block title %}Tasks - Task Management{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-list-task"></i> Tasks</h1>
    {% if user.is_admin or user.is_team_leader %}
    <a href="{% url 'task_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> New Task
    </a>
    {% endif %}
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <select name="status" class="form-select">
                    <option value="">All Status</option>
                    <option value="OPEN">Open</option>
                    <option value="IN_PROGRESS">In Progress</option>
                    <option value="SUBMITTED">Submitted</option>
                    <option value="IN_REVIEW">In Review</option>
                    <option value="DONE">Done</option>
                </select>
            </div>
            <div class="col-md-3">
                <select name="priority" class="form-select">
                    <option value="">All Priorities</option>
                    <option value="P0">P0 - Critical</option>
                    <option value="P1">P1 - High</option>
                    <option value="P2">P2 - Medium</option>
                    <option value="P3">P3 - Low</option>
                </select>
            </div>
            <div class="col-md-4">
                <select name="project" class="form-select">
                    <option value="">All Projects</option>
                    {% for project in projects %}
                    <option value="{{ project.id }}">{{ project.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
            </div>
        </form>
    </div>
</div>

<!-- Tasks List -->
<div class="row">
    {% for task in tasks %}
    <div class="col-md-6 mb-3">
        <div class="card card-hover h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title mb-0">
                        <a href="{% url 'task_detail' task.pk %}" class="text-decoration-none">{{ task.title }}</a>
                    </h5>
                    <div>
                        <span class="badge badge-priority-{{ task.priority }}">{{ task.get_priority_display }}</span>
                    </div>
                </div>
                <p class="card-text text-muted">{{ task.description|truncatewords:20 }}</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="badge badge-status-{{ task.status }}">{{ task.get_status_display }}</span>
                        <small class="text-muted">{{ task.project.name }}</small>
                    </div>
                    {% if task.due_date %}
                    <small class="text-muted"><i class="bi bi-calendar"></i> {{ task.due_date }}</small>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i> No tasks found.
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
